---

- name: Get Virtual IP health statistics - F5 ServiceCenter
  hosts: localhost
  gather_facts: false
  connection: local
  vars:
   url: 
   api_token: 

  tasks:


  - name: XC Get service policies
    ansible.builtin.uri:
     url: "{{ url }}"
     method: GET
     body_format: json
     status_code: [200, 202]
     return_content: true
     headers:
       Content-Type: application/json
       Authorization: "APIToken {{ api_token }}"
    register: xc


  - name: XC Get service policies
    ansible.builtin.uri:
     url: "{{ url }}/{{ item }}"
     method: GET
     body_format: json
     status_code: [200, 202]
     return_content: true
     headers:
       Content-Type: application/json
       Authorization: "APIToken {{ api_token }}"
    loop: "{{ xc.json | json_query('items[*].name') }}"
    register: object
    ignore_errors: true


  - debug: msg="Service Policy - {{item}}"
    loop: "{{object.results}}"

